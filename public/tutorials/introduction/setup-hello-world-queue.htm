<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-conditions="Spryker.DemoShop,Spryker.B2B,Spryker.B2C" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Tutorials|Introduction">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Tutorial - Set Up a "Hello World" Queue - Legacy Demoshop  </title>
        <!-- Google Tag Manager -->
        <script>/* <![CDATA[ */(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-NP24S2');/* ]]> */</script>
        <!-- End Google Tag Manager -->
        <script>/* <![CDATA[ */
			var s = document.createElement("script");
			s.type = "text/javascript";
			s.src = "https://www.googletagmanager.com/gtag/js?id==UA-56589105-4";
			document.getElementsByTagName('head').item(0).appendChild(s);
		/* ]]> */</script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-56589105-4');
		/* ]]> */</script>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/perfect-scrollbar.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../resources/scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../resources/scripts/custom.modernizr.js">
        </script>
        <script src="../../resources/scripts/jquery.min.js">
        </script>
        <script src="../../resources/scripts/require.min.js">
        </script>
        <script src="../../resources/scripts/require.config.js">
        </script>
        <script src="../../resources/scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../resources/scripts/plugins.min.js">
        </script>
        <script src="../../resources/scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <!-- Google Tag Manager (noscript) -->
                                <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                </noscript>
                                <!-- End Google Tag Manager (noscript) -->
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="breadcrumbs-block">
                                            <div class="nocontent">
                                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                        </div>
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_SearchHome mc-component">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="eK3x7XQt90u2mlrIT33-hw">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="eK3x7XQt90u2mlrIT33-hw:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="toolbar-wrapper">
                                                    <div class="widget-github js-widget-github"><a class="widget-github-link js-widget-github-link" href="https://github.com/spryker/spryker-documentation" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M13.5 0C6.057 0 0 6.057 0 13.5c0 5.888 3.791 10.905 9.058 12.745a.463.463 0 0 0 .258.088c1.316.43 2.724.667 4.184.667C20.943 27 27 20.943 27 13.5S20.943 0 13.5 0zm0 .931c6.93 0 12.569 5.639 12.569 12.569 0 5.428-3.459 10.061-8.287 11.818a1.903 1.903 0 0 1-.092-.527v-2.446c0-.975-.477-2.037-.946-2.75 2.584-.436 5.537-1.776 5.537-6.779 0-1.37-.429-2.58-1.275-3.598.186-.611.415-1.9-.225-3.52a.47.47 0 0 0-.291-.272c-.13-.04-1.326-.35-3.806 1.277a12.921 12.921 0 0 0-6.36 0c-2.481-1.63-3.68-1.319-3.809-1.277a.47.47 0 0 0-.29.273C5.582 7.319 5.811 8.607 6 9.218c-.85 1.018-1.279 2.227-1.279 3.598 0 4.957 2.9 6.323 5.463 6.778-.322.407-.66.934-.81 1.47-.661.184-2.018.19-2.929-1.37-.032-.06-.829-1.475-2.4-1.584-.25.002-.882.042-1.035.525-.169.537.424.944.679 1.117l.058.034c.029.015.707.371 1.213 1.644.105.333 1.03 2.84 4.353 2.399.002.367 0 .552-.004.7v.26c0 .15-.045.378-.096.525C4.386 23.558.931 18.924.931 13.5.931 6.57 6.57.931 13.5.931zm6.51 5.375c.5 1.471.158 2.537.035 2.839a.468.468 0 0 0 .089.49c.805.883 1.214 1.952 1.214 3.181 0 4.72-2.796 5.666-5.535 5.97a.464.464 0 0 0-.253.815c.368.314 1.199 1.68 1.199 2.744v2.446c0 .009.001.414.134.809a12.513 12.513 0 0 1-6.792-.002c.135-.396.139-.802.139-.81l.001-.248c.002-.211.006-.497 0-1.266a.473.473 0 0 0-.174-.362.47.47 0 0 0-.391-.09c-3.126.681-3.802-1.576-3.828-1.67l-.016-.047c-.448-1.135-1.037-1.713-1.388-1.975.759.267 1.182 1.007 1.193 1.024 1.231 2.107 3.264 2.162 4.328 1.685a.463.463 0 0 0 .27-.36c.095-.665.826-1.545 1.196-1.87a.464.464 0 0 0 .136-.488.461.461 0 0 0-.39-.324c-2.73-.31-5.524-1.266-5.524-5.98 0-1.228.41-2.3 1.219-3.181a.464.464 0 0 0 .087-.491c-.124-.302-.467-1.364.031-2.837.396.013 1.362.182 2.988 1.286.112.076.256.1.387.063.973-.27 2.058-.416 3.135-.421 1.08.005 2.166.15 3.14.421.131.037.273.013.386-.063 1.635-1.11 2.6-1.275 2.984-1.288z" /></svg></a>
                                                    </div>
                                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic NextTopic Print ExpandAll CollapseAll;">
                                                        <div class="button-group-container-left">
                                                            <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                                            </button>
                                                            <button class="button needs-pie next-topic-button" title="Navigate next">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                                            </button>
                                                            <button class="button needs-pie print-button" title="Print">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                            </button>
                                                            <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="js-anchorer main-content">
                                                    <h1>Tutorial - Set Up a "Hello World" Queue - Legacy Demoshop <img src="../../resources/images/shoptype/b2b_shop.png" /> <img src="../../resources/images/shoptype/b2c_shop.png" /></h1>
                                                    <p>This Tutorial demonstrates a simple <code>Hello, World</code> queue use case. We will create a <code>hello </code>queue and send/receive our messages to/from this queue with <code>Hello, World</code> content. </p>
                                                    <p>For this purpose, we will be using our default queue engine RabbitMQ.

</p>
                                                    <h2>Preparation
</h2>
                                                    <p>Before you begin, check to see that the management UI and the RabbitMQ adapter are installed and working:

</p>
                                                    <h3>RabbitMQ Management UI
</h3>
                                                    <p>The management UI is used for managing queues in the RabbitMQ UI therefore, we need to add Admin permissions:

</p>
                                                    <p><strong>To add Admin permissions</strong>:

</p>
                                                    <ol>
                                                        <li value="1">Go to the RabbitMQ management UI: <code>http://zed.de.demoshop.local:15672/</code> and login.
</li>
                                                        <li value="2">Go to the <code>Admin </code>tab and select <code>admin </code>from user table under All users.
</li>
                                                        <li value="3">From <code>Virtual Host</code> select /<code>DE_development_zed</code> (for other stores it might be different).
</li>
                                                        <li value="4">Click <code>Set permission</code>.
</li>
                                                        <li value="5">You will now see the new permission in the table.
</li>
                                                    </ol>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_admin.png" />and provide basic configuration for listening to the</p>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_permission.png" />
                                                    </p>
                                                    <p class="important">If you are working with different virtual hosts, you need to add them as well.</p>
                                                    <h3>RabbitMQ Adapter
</h3>
                                                    <p>The Queue module needs at least one queue adapter.

</p>
                                                    <p><strong>To check if the RabbitMQ adapter is already registered in the Queue module</strong>:

</p>
                                                    <p>In the Demoshop, open <code>QueueDependencyProvider.php</code> and check/add the RabbitMQ adapter inside <code>createQueueAdapters()</code>:

</p>
                                                    <p><strong>Example</strong>:

</p><pre><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Client\Queue;

class QueueDependencyProvider extends BaseQueueDependencyProvider
{
    protected function createQueueAdapters(Container $container)
    {
        return [
            $container-&gt;getLocator()-&gt;rabbitMq()-&gt;client()-&gt;createQueueAdapter(),
        ];
    }
}
?&gt;
</code></pre>
                                                    <h2>Creating a Simple Queue
</h2>
                                                    <p>Before sending our messages to the <code>hello </code>queue, we need to first configure the Queue Adapter and then add queue configuration to RabbitMQ.
        <p class="info"><strong>Default Queue Adapter</strong>
            You can skip this part if you want to use the default queue adapter:
            $config[QueueConstants::QUEUE_ADAPTER_CONFIGURATION_DEFAULT]
        </p></p>
                                                    <h3>Defining the Queue Adapter
</h3>
                                                    <p>As mentioned, we can have different queue adapters for different queues, in this example we will configure our hello queue to work with the RabbitMQ adapter.
</p>
                                                    <p>
To configure a queue work with a queue adapter, add the following lines to <code>config_default.php</code>:

</p><pre><code class="language-PHP line-numbers">&lt;?php

use Spryker\Shared\Queue\QueueConfig;
...

$config[QueueConstants::QUEUE_ADAPTER_CONFIGURATION] = [
    'hello' =&gt; [
        QueueConfig::CONFIG_QUEUE_ADAPTER =&gt; \Spryker\Client\RabbitMq\Model\RabbitMqAdapter::class,
    ],
];

...
?&gt;
Adding Queue Configuration to RabbitMQ
</code></pre>
                                                    <p>The next step is to extend <code>RabbitMqConfig.php</code> in our project and then pass our configuration to <code>getQueueOptions()</code>:
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Client\RabbitMq;

use Generated\Shared\Transfer\RabbitMqOptionTransfer;
use Spryker\Client\RabbitMq\Model\Connection\Connection;
use Spryker\Client\RabbitMq\RabbitMqConfig as SprykerRabbitMqConfig;

class RabbitMqConfig extends SprykerRabbitMqConfig
{
    /**
     * @return \ArrayObject
     */
    protected function getQueueOptions()
    {
        $queueOptionCollection = new ArrayObject();
        ...
        $queueOptionCollection-&gt;append($this-&gt;createQueueOption('hello', 'hello.error'));

        return $queueOptionCollection;
    }
?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p class="info"><strong>Exchange
</strong>
                                                        <br />Exchanges and why do I need them? The best practice for working with Rabbit MQ requires to not create queues directly in RabbitMQ but to use a gateway which binds to the queues. Gateways in RabbitMQ are called Exchanges.</p>
                                                    <p>
The following image shows how the RabbitMQ exchange and queue work together. You can find more information about Exchange and Routing at:&#160;<a href="https://www.rabbitmq.com/tutorials/tutorial-four-php.html" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-four-php.html</a>.
</p>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_exchange.png" />
                                                    </p>
                                                    <p class="tip"><strong>Queue creation</strong>
                                                        <br />Our queue configuration is ready, once we send our first message the queue will be created.
</p>
                                                    <h2>Sending Messages
</h2>
                                                    <p>We are almost done with all queue preparation and configuration, it’s time to see some actions. Here we want to send one message to our queue and check if this message is there.
</p>
                                                    <p class="note"><strong>Using clients<![CDATA[
]]></strong>
                                                        <br />We assume that you already know how to use a client in the Controller classes, but you can also check our other tutorials or the Demoshop codebase

</p>
                                                    <p><strong>To send a message to a queue</strong>: </p>
                                                    <p>Place a trigger to the queue API by creating a simple controller/action in the Demoshop.

</p>
                                                    <p>This code creates a <code>QueueSendMessageTransfer</code> and sets <code>Hello, World</code> into the body of message. </p>
                                                    <p>The final step is to call <code>QueueClient::sendMessage()</code> and the trigger will be set.
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Yves\Application\Controller;

use Generated\Shared\Transfer\QueueSendMessageTransfer;
use Spryker\Yves\Kernel\Controller\AbstractController;

class QueueController extends AbstractController
{

    public function sendAction()
    {
        $queueSendTransfer = new QueueSendMessageTransfer();
        $queueSendTransfer-&gt;setBody('Hello, World!');

        $queueClient = $this-&gt;getFactory()-&gt;getQueueClient();
        $queueClient-&gt;sendMessage('hello', $queueSendTransfer);

        return [
            'success' =&gt; true
        ];
    }
}

?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Next, we call the action.

</p>
                                                    <p><strong>To call an action</strong>:

</p>
                                                    <ol>
                                                        <li value="1">Open a browser and call the following url <code>http://www.de.demoshop.local/queue/send</code>.
</li>
                                                        <li value="2">Check the RabbitMQ management UI <code>http://zed.de.project.local:15672/#/queues</code> to see if the hello queue is created and there is a message in there.
</li>
                                                    </ol>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_creation.png" />
                                                    </p>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_message.png" />
                                                    </p>
                                                    <p><![CDATA[ 
]]><strong>Result</strong>: You successfully created the <code>hello </code>queue and sent one message with <code>Hello, World!</code> inside.

</p>
                                                    <h2>Receiving Messages</h2>
                                                    <p>To receive messages, you need to create another action for receiving messages from the <code>hello </code>queue.

To create another action for receiving a message from the <code>hello </code>queue:
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php


    public function receiveAction()
    {
        $queueClient = $this-&gt;getFactory()-&gt;getQueueClient();

        $queueReceiveMessageTransfer = $queueClient-&gt;receiveMessage('hello', $this-&gt;createReceiverOption());

        return [
            'message' =&gt; $queueReceiveMessageTransfer-&gt;getQueueMessage()-&gt;getBody(),
            'success' =&gt; true
        ];
    }

    /**
     * @return array
     */
    protected function createReceiverOption()
    {
        $rabbitmqReceiveOptionTransfer = new RabbitMqConsumerOptionTransfer();
        $rabbitmqReceiveOptionTransfer-&gt;setNoAck(false); /* it prevents the queue to delete the message until we send the `acknowledging` */

        return [
            'rabbitmq' =&gt; $rabbitmqReceiveOptionTransfer
        ];
    }
    
?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Now, open a browser and call the following url <code>http://www.de.demoshop.local/queue/receive</code>.

</p>
                                                    <p><strong>Result</strong>: you should be able to see this:
</p>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_receive.png" />
                                                    </p>
                                                    <h2>

Advanced Topics
</h2>
                                                    <p>Until now we demonstrated working with a simple queue and performing simple send receive actions on it. However, these actions can be automated to help developers focus on business logic. To automate the queue you can use Spryker’s Task and Worker to provide flexibility and freedom when managing queues.

This chapter includes three parts. Parts one and two demonstrate Task and Plugin which bind together and in third part we will describe background processes and task management.

</p>
                                                    <h3>Running a Queue Task
</h3>
                                                    <p>The Queue module provides specific commands for listening to queues, fetching messages and triggering registered processors. Running this command allows you to see what messages the queue is going to consume and pass to the plugins.

The command syntax is:</p><pre><code class="language-PHP line-numbers">/vendor/bin/console queue:task:start &lt;queue-name&gt;
</code></pre>
                                                    <p>Let’s run this command for <code>hello </code>queue and see what happens:

</p><pre><code class="language-PHP line-numbers">./vendor/bin/console queue:task:start hello
Store: DE | Environment: development
...MissingQueuePluginException - Exception: There is no message processor plugin registered for this queue: hello, you can fix this error by adding it in QueueDependencyProvider
...
</code></pre>
                                                    <p>The command triggered an error message, this happened because we did not register our Plugin for the hello queue. In the next step, we will fix this.

</p>
                                                    <h3>Queue Message Processor Plugin
</h3>
                                                    <p>Plugins in queue are used to give more focus on message processing to developers by hiding the queue implementation.

</p>
                                                    <p>We will start by writing a simple plugin which will write a <code>Hello, World!</code> message to output:
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php
namespace Pyz\Zed\Application\Communication\Plugin;

use Spryker\Zed\Queue\Dependency\Plugin\QueueMessageProcessorPluginInterface;

class HelloQueueMessageProcessorPlugin implements QueueMessageProcessorPluginInterface
{

    public function processMessages(array $queueMessageTransfers)
    {
        foreach ($queueMessageTransfers as $queueMessageTransfer) {
            try {
                /* Sample Code */
                echo sprintf("[x] %s \r\n", $queueMessageTransfer-&gt;getQueueMessage()-&gt;getBody());
                $queueMessageTransfer-&gt;setAcknowledge(true); /* we acknowledge the message to remove it from the queue */
            } catch (\Exception $e) {
                $queueMessageTransfer-&gt;setHasError(true); /* we mark the message as an error, it will call errorHandling() for provided queue adapter on this message */
            }
        }

        return $queueMessageTransfers;
    }

    public function getChunkSize()
    {
        /* Sample Chunk Size */
        return 10;
    }
}
?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Now, register the plugin to <code>QueueDependencyProvider::getProcessorMessagePlugins()</code>:
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php
namespace Pyz\Zed\Queue;

use Pyz\Zed\Application\Communication\Plugin\HelloQueueMessageProcessorPlugin;
use Spryker\Zed\Kernel\Container;
use Spryker\Zed\Queue\QueueDependencyProvider as SprykerQueueDependencyProvider;

class QueueDependencyProvider extends SprykerQueueDependencyProvider
{

    protected function getProcessorMessagePlugins(Container $container)
    {
        return [
            'hello' =&gt; new HelloQueueMessageProcessorPlugin()
        ];
    }
}

?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p class="info"><strong>Default Queue Consumer:</strong>
            You can skip this part if you want to use the default queue consumer:
            QueueConstants::QUEUE_DEFAULT_RECEIVER
        </p>
                                                    <p>and provide basic configuration for listening to the <code>hello </code>queue:
</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre class=" language-php line-numbers"><code class="language-php">&lt;?php
namespace Pyz\Zed\Queue;

use Generated\Shared\Transfer\RabbitMqConsumerOptionTransfer;
use Spryker\Zed\Queue\QueueConfig as SprykerQueueConfig;

class QueueConfig extends SprykerQueueConfig
{

    protected function getQueueReceiverOptions()
    {
        return [
            'hello' =&gt; [
                'rabbitmq' =&gt; $this-&gt;getRabbitMQReceiverOption()
            ]
        ];
    }

    protected function getRabbitMQReceiverOption()
    {
        $queueOptionTransfer = new RabbitMqConsumerOptionTransfer();
        $queueOptionTransfer-&gt;setConsumerExclusive(false);
        $queueOptionTransfer-&gt;setNoWait(false);

        return $queueOptionTransfer;
    }
}

?&gt;
</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Now when we run this command again the queue task will run:
        </p><pre xml:space="preserve"><code class="bash">./vendor/bin/console queue:task:start hello
Store: DE | Environment: development
[x] Hello, World!</code></pre>
                                                    <h3>Queue Workers
</h3>
                                                    <p>A queue <code>Worker </code>is another useful command that brings the <code>Task </code>to a background process and provides parallel processing. By adjusting the <code>Worker </code>config we can run tasks with different time slot and different amount of processes.

</p>
                                                    <p>
                                                        <img src="../../resources/images/rabbitmq_worker.png" />
                                                    </p>
                                                    <p>Lets start <code>Worker </code>for our <code>hello </code>queue, first we need to adjust worker config in <code>config_default.php</code>:


</p><pre><code class="language-PHP line-numbers">&lt;?php

$config[QueueConstants::QUEUE_WORKER_INTERVAL_MILLISECONDS] = 1000; /* Deley between each execution */
$config[QueueConstants::QUEUE_WORKER_MAX_THRESHOLD_SECONDS] = 59; /* Total execution time */

$config[QueueConstants::QUEUE_ADAPTER_CONFIGURATION] = [
    'hello' =&gt; [
        QueueConfig::CONFIG_QUEUE_ADAPTER =&gt; \Spryker\Client\RabbitMq\Model\RabbitMqAdapter::class,
        QueueConfig::CONFIG_MAX_WORKER_NUMBER =&gt; 2 /* we want to have 2 processor for hello queue */
    ],
];

?&gt;
</code></pre>
                                                    <p>In the example above, we adjusted our config to let the worker run for 1 minute and execute 2 <code>hello </code>task processes every 1 second. We can scale-up this in production by adding more and more processors, but we always need to keep in mind resources and limitations.

</p>
                                                    <p>Now run:

</p><pre><code class="language-PHP line-numbers">./vendor/bin/console queue:worker:start -vvv
Store: DE | Environment: development
01) New: 2 Busy: 0 [hello]
Main Queue Process &lt;execution round #1&gt;: 59/59 sec [============================] 100%%
</code></pre>
                                                    <p><strong>To run the worker command every minute, enable the command in <code>jobs.php</code></strong>:


</p><pre><code class="language-PHP line-numbers">&lt;?php

$jobs[] = [
    'name' =&gt; 'queue-worker-start',
    'command' =&gt; '$PHP_BIN vendor/bin/console queue:worker:start -vvv',
    'schedule' =&gt; '* * * * *',
    'enable' =&gt; true,
    'run_on_non_production' =&gt; true,
    'stores' =&gt; $allStores,
];

?&gt;
</code></pre>
                                                    <p>&#160;</p>
                                                    <p><![CDATA[
		
		]]><b>See also:
</b></p>
                                                    <ul>
                                                        <li value="1"><![CDATA[
                ]]><a href="https://documentation.spryker.com/capabilities/development/queue/queue.htm">Queue</a><![CDATA[
            ]]></li>
                                                        <li value="2"><![CDATA[
                ]]><a href="https://documentation.spryker.com/capabilities/development/queue/queue.htm#default-queue-adapter">Default Queue Adapter</a><![CDATA[
            ]]></li>
                                                        <li value="3"><![CDATA[
                ]]><a href="https://documentation.spryker.com/capabilities/development/queue/queue.htm#queue-workers">Queue Workers</a><![CDATA[
            ]]></li>
                                                        <li value="4"><![CDATA[
                ]]><a href="https://documentation.spryker.com/capabilities/development/queue/queue.htm#queue-task">Queue Task</a><![CDATA[
            ]]></li>
                                                        <li value="5"><![CDATA[
                ]]><a href="https://documentation.spryker.com/module_migration_guides/mg-rabbitmq.htm">Migration Guide - RabbitMQ</a><![CDATA[
            ]]></li>
                                                    </ul>
                                                    <p>&#160;</p>
                                                    <p><i>Last review date: Oct 18, 2017 </i><![CDATA[    ]]></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><a class="scroll-top js-scroll-top" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="#FFF" fill-rule="nonzero" d="M11.82 5.22a.54.54 0 0 1 0 .806.636.636 0 0 1-.852 0L6.607 1.937v13.49a.587.587 0 0 1-.602.573c-.336 0-.611-.258-.611-.573V1.937L1.04 6.026a.647.647 0 0 1-.86 0 .54.54 0 0 1 0-.807L5.573.163a.636.636 0 0 1 .852 0L11.82 5.22z" /></svg></a>
                                <script>/* <![CDATA[ */
			function createGithubUrl() {
			var GITHUB_CONTENT_PATH = '/blob/master/public';
			var link = document.querySelector('.js-widget-github-link');
			var href =
			link.getAttribute('href')
			+ GITHUB_CONTENT_PATH
			+ window.location.pathname;
			link.setAttribute('href', href);
			}
			createGithubUrl();
		/* ]]> */</script>
                                <script>/* <![CDATA[ */
			requirejs.config({
				appDir: '',
				paths: {
					'clipboard': ['https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min']
					
				}
			});
			require(['clipboard'], function(Clipboard) {
				console.log(Clipboard);
				window.Clipboard = Clipboard;
			});
		/* ]]> */</script>
                                <script src="../../resources/scripts/perfect-scrollbar.js">
                                </script>
                                <script src="../../resources/scripts/imagemapster.js">
                                </script>
                                <script src="../../resources/scripts/script.js">
                                </script>
                                <script src="../../resources/scripts/prism.js">
                                </script>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
